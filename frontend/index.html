<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelMaster AI - Plan Your Dream Vacation</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .travel-bg {
            min-height: 100vh;
        }

        .voice-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Rescheduling animations */
        @keyframes rescheduleFlash {
            0% {
                background-color: rgba(255, 193, 7, 0.3);
                transform: scale(1);
            }

            50% {
                background-color: rgba(255, 193, 7, 0.6);
                transform: scale(1.02);
            }

            100% {
                background-color: rgba(255, 193, 7, 0.3);
                transform: scale(1);
            }
        }

        @keyframes newItemPulse {
            0% {
                background-color: rgba(76, 175, 80, 0.3);
                transform: scale(1);
            }

            50% {
                background-color: rgba(76, 175, 80, 0.6);
                transform: scale(1.02);
            }

            100% {
                background-color: rgba(76, 175, 80, 0.3);
                transform: scale(1);
            }
        }

        .rescheduling-item {
            animation: rescheduleFlash 2s ease-in-out infinite;
            border: 2px solid rgba(255, 193, 7, 0.5) !important;
        }

        .new-schedule-item {
            animation: newItemPulse 1.5s ease-in-out;
            border: 2px solid rgba(76, 175, 80, 0.5) !important;
        }

        .slide-in-change {
            animation: slideInFromRight 0.8s ease-out;
        }

        @keyframes slideInFromRight {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }

            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .disruption-btn {
            background: linear-gradient(135deg, #ff6b6b, #ff8787);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
        }

        .disruption-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .disruption-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
            animation: overlayFadeIn 0.5s ease-out;
        }

        @keyframes overlayFadeIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }

            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .overlay-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .boarding-pass {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }

        .boarding-pass::before {
            content: '';
            position: absolute;
            top: 0;
            right: 100px;
            width: 2px;
            height: 100%;
            background: repeating-linear-gradient(to bottom,
                    white 0px,
                    white 5px,
                    transparent 5px,
                    transparent 10px);
        }

        .event-ticket {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #333;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border: 2px dashed #ff8a65;
            position: relative;
        }

        .ticket-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .ticket-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            animation: ticketSlideIn 0.5s ease-out;
        }

        @keyframes ticketSlideIn {
            0% {
                opacity: 0;
                transform: translateY(50px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .travel-card {
            transition: all 0.3s ease;
            border-left: 4px solid #007bff;
            background: white;
            border-radius: 12px;
        }

        .travel-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 123, 255, 0.2);
            border-left-color: #28a745;
        }

        .airport-info {
            background: linear-gradient(45deg, rgba(0, 123, 255, 0.1), rgba(40, 167, 69, 0.1));
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 0.85rem;
            color: #495057;
            border: 1px solid rgba(0, 123, 255, 0.3);
            margin: 4px 0;
        }

        .flight-number {
            background: linear-gradient(45deg, #007bff, #0056b3);
            border-radius: 20px;
            padding: 4px 12px;
            font-weight: bold;
            font-size: 0.85rem;
            color: white;
            border: none;
            display: inline-block;
            margin-right: 8px;
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3);
        }

        .destination-preview {
            border-radius: 12px;
            overflow: hidden;
            height: 300px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            margin-bottom: 16px;
            position: relative;
        }

        .hackathon-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            text-align: center;
        }

        /* Modal and Animation Styles */
        @keyframes modalSlideIn {
            0% {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes modalSlideOut {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
        }

        @keyframes rescheduleFlash {
            0% {
                background-color: rgba(245, 158, 11, 0.2);
                border-color: rgba(245, 158, 11, 0.5);
            }

            50% {
                background-color: rgba(245, 158, 11, 0.4);
                border-color: rgba(245, 158, 11, 0.8);
            }

            100% {
                background-color: rgba(245, 158, 11, 0.2);
                border-color: rgba(245, 158, 11, 0.5);
            }
        }

        /* Barcode Scanning Animation */
        .barcode-container {
            position: relative;
            overflow: hidden;
            padding: 1rem 0;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .barcode-lines {
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            letter-spacing: 3px;
            text-align: center;
            color: #000;
            position: relative;
            user-select: none;
        }

        .scan-line {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(255, 59, 48, 0.3) 20%,
                    rgba(255, 59, 48, 0.8) 50%,
                    rgba(255, 59, 48, 0.3) 80%,
                    transparent 100%);
            animation: barcodeScanning 3s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes barcodeScanning {
            0% {
                left: -100%;
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            50% {
                left: 100%;
                opacity: 1;
            }

            90% {
                opacity: 1;
            }

            100% {
                left: 100%;
                opacity: 0;
            }
        }

        .barcode-container:hover .scan-line {
            animation-duration: 1.5s;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }

            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        .hotel-image,
        .destination-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 12px;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Main App Component
        function TravelMasterApp() {
            // API Configuration
            const API_BASE = 'http://localhost:8000';

            // Auth0 Configuration - SPA Application
            const AUTH0_DOMAIN = 'dev-5sxkcuwmv28osx0h.us.auth0.com'; // Your Auth0 domain
            const AUTH0_CLIENT_ID = 'UsjWQHn4crWHZaQHgbFqDPd6JNbIFbsI'; // Your SPA Client ID
            const AUTH0_AUDIENCE = 'TravelAgent'; // Your API audience

            // Authentication State
            const [auth0Client, setAuth0Client] = useState(null);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [user, setUser] = useState(null);
            const [accessToken, setAccessToken] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);

            const [currentStep, setCurrentStep] = useState('auth');
            const [travelRequest, setTravelRequest] = useState({
                destination: '',
                departure_location: '',
                start_date: '',
                end_date: '',
                budget: 3000,
                travelers: 2,
                preferences: ['mid_range', 'cultural'],
                special_requirements: ''
            });
            const [isLoading, setIsLoading] = useState(false);
            const [itinerary, setItinerary] = useState(null);
            const [comprehensiveItinerary, setComprehensiveItinerary] = useState(null);
            const [isListening, setIsListening] = useState(false);
            const [bookedTrip, setBookedTrip] = useState(null);
            const [userTrips, setUserTrips] = useState([]);
            const [selectedTrip, setSelectedTrip] = useState(null);

            // Create refs for form inputs to avoid focus issues
            const destinationRef = useRef(null);
            const departureRef = useRef(null);
            const budgetRef = useRef(null);
            const specialReqRef = useRef(null);
            const startDateRef = useRef(null);
            const endDateRef = useRef(null);
            const travelersRef = useRef(null);
            const preferencesRef = useRef(new Set());

            // Auth0 Initialization
            useEffect(() => {
                const initAuth0 = async () => {
                    try {
                        // Check if Auth0 credentials are configured
                        if (AUTH0_DOMAIN === 'your-domain.auth0.com' || AUTH0_CLIENT_ID === 'your-client-id') {
                            console.warn('Auth0 not configured - using demo mode');
                            setAuthLoading(false);
                            setCurrentStep('trips');
                            return;
                        }

                        const auth0 = await window.auth0.createAuth0Client({
                            domain: AUTH0_DOMAIN,
                            clientId: AUTH0_CLIENT_ID,
                            authorizationParams: {
                                redirect_uri: window.location.origin,
                                audience: AUTH0_AUDIENCE,
                                scope: 'openid profile email'
                            }
                        });

                        setAuth0Client(auth0);

                        // Handle redirect callback
                        if (window.location.search.includes('code=')) {
                            await auth0.handleRedirectCallback();
                            window.history.replaceState({}, document.title, window.location.pathname);
                        }

                        // Check if user is authenticated
                        const authenticated = await auth0.isAuthenticated();
                        setIsAuthenticated(authenticated);

                        if (authenticated) {
                            const userProfile = await auth0.getUser();
                            const token = await auth0.getTokenSilently();
                            setUser(userProfile);
                            setAccessToken(token);
                            setCurrentStep('trips');
                        }

                    } catch (error) {
                        console.error('Auth0 initialization error:', error);
                    } finally {
                        setAuthLoading(false);
                    }
                };

                initAuth0();
            }, []);

            // Authentication Functions
            const login = () => {
                if (auth0Client) {
                    auth0Client.loginWithRedirect({
                        authorizationParams: {
                            screen_hint: 'login'
                        }
                    });
                }
            };

            const signup = () => {
                if (auth0Client) {
                    auth0Client.loginWithRedirect({
                        authorizationParams: {
                            screen_hint: 'signup'
                        }
                    });
                }
            };

            const logout = () => {
                if (auth0Client) {
                    auth0Client.logout({
                        logoutParams: {
                            returnTo: window.location.origin
                        }
                    });
                }
            };

            // Voice Recognition Setup
            const startVoiceRecognition = () => {
                if ('webkitSpeechRecognition' in window) {
                    const recognition = new webkitSpeechRecognition();
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    recognition.lang = 'en-US';

                    recognition.onstart = () => {
                        setIsListening(true);
                    };

                    recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript.toLowerCase();
                        parseVoiceInput(transcript);
                    };

                    recognition.onend = () => {
                        setIsListening(false);
                    };

                    recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        setIsListening(false);
                    };

                    recognition.start();
                } else {
                    alert('Speech recognition not supported in this browser');
                }
            };

            // Parse voice input
            const parseVoiceInput = (text) => {
                console.log('Voice input:', text);

                // Parse destinations
                if (text.includes('paris')) setTravelRequest(prev => ({ ...prev, destination: 'Paris, France' }));
                if (text.includes('london')) setTravelRequest(prev => ({ ...prev, destination: 'London, UK' }));
                if (text.includes('tokyo')) setTravelRequest(prev => ({ ...prev, destination: 'Tokyo, Japan' }));
                if (text.includes('new york')) setTravelRequest(prev => ({ ...prev, destination: 'New York, USA' }));

                // Parse budget
                const budgetMatch = text.match(/budget.*?(\d+)/);
                if (budgetMatch) {
                    setTravelRequest(prev => ({ ...prev, budget: parseFloat(budgetMatch[1]) }));
                }

                // Parse preferences
                if (text.includes('luxury')) {
                    setTravelRequest(prev => ({
                        ...prev,
                        preferences: [...prev.preferences, 'luxury']
                    }));
                }
                if (text.includes('budget')) {
                    setTravelRequest(prev => ({
                        ...prev,
                        preferences: [...prev.preferences, 'budget']
                    }));
                }
                if (text.includes('adventure')) {
                    setTravelRequest(prev => ({
                        ...prev,
                        preferences: [...prev.preferences, 'adventure']
                    }));
                }
            };

            // Function to get destination image URL using a more reliable service
            const getDestinationImage = (destination) => {
                const cityName = destination.split(',')[0].toLowerCase().replace(/\s+/g, '-');
                // Use Picsum with a specific seed for consistent images
                const seed = cityName.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
                return `https://picsum.photos/seed/${seed}/800/300`;
            };

            // Function to get hotel image
            const getHotelImage = (hotelName, index) => {
                const seed = (hotelName + index).split('').reduce((a, b) => a + b.charCodeAt(0), 0);
                return `https://picsum.photos/seed/hotel${seed}/400/250`;
            };

            // Function to get activity image
            const getActivityImage = (activityName, index) => {
                const seed = (activityName + index).split('').reduce((a, b) => a + b.charCodeAt(0), 0);
                return `https://picsum.photos/seed/activity${seed}/300/200`;
            };

            // Function to get restaurant image
            const getRestaurantImage = (restaurantName, index) => {
                const seed = (restaurantName + index).split('').reduce((a, b) => a + b.charCodeAt(0), 0);
                return `https://picsum.photos/seed/restaurant${seed}/400/250`;
            };

            // Calendar and reservations functions
            const downloadCalendar = async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/calendar/sample_trip_123`);
                    const calendarData = await response.json();

                    // Create ICS file content
                    const icsContent = generateICSFile(calendarData);

                    // Download the file
                    const blob = new Blob([icsContent], { type: 'text/calendar' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `trip-calendar-${new Date().toISOString().split('T')[0]}.ics`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    alert('📅 Calendar downloaded successfully! Import into your calendar app.');
                } catch (error) {
                    console.error('Calendar download error:', error);
                    alert('❌ Failed to download calendar. Please try again.');
                }
            };

            const generateICSFile = (calendarData) => {
                const now = new Date().toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                let icsContent = [
                    'BEGIN:VCALENDAR',
                    'VERSION:2.0',
                    'PRODID:-//TravelMaster AI//Trip Calendar//EN',
                    'CALSCALE:GREGORIAN'
                ].join('\r\n');

                // Add events from calendar data
                const events = [
                    {
                        summary: 'Flight Departure - AA1234',
                        description: 'Flight from JFK to CDG\\nConfirmation: ABC123',
                        location: 'JFK Airport, Terminal 4',
                        start: '20251027T080000Z',
                        end: '20251027T100000Z'
                    },
                    {
                        summary: 'Hotel Check-in',
                        description: 'Check-in at Hotel Paris\\nConfirmation: HTL456',
                        location: '123 Champs-Élysées, Paris, France',
                        start: '20251027T143000Z',
                        end: '20251027T150000Z'
                    },
                    {
                        summary: 'Dinner at Francette',
                        description: 'Restaurant reservation for 2\\nConfirmation: RST789',
                        location: '1 Port de Suffren, 75007 Paris, France',
                        start: '20251027T190000Z',
                        end: '20251027T210000Z'
                    }
                ];

                events.forEach((event, index) => {
                    icsContent += '\r\n' + [
                        'BEGIN:VEVENT',
                        `UID:${now}-${index}@travelmaster-ai.com`,
                        `DTSTAMP:${now}`,
                        `DTSTART:${event.start}`,
                        `DTEND:${event.end}`,
                        `SUMMARY:${event.summary}`,
                        `DESCRIPTION:${event.description}`,
                        `LOCATION:${event.location}`,
                        'STATUS:CONFIRMED',
                        'END:VEVENT'
                    ].join('\r\n');
                });

                icsContent += '\r\nEND:VCALENDAR';
                return icsContent;
            };

            const startDisruptionMonitoring = async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/monitor-disruptions`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            trip_id: 'sample_trip_123',
                            notifications: ['email', 'push'],
                            monitor_types: ['flight_delays', 'weather_alerts', 'activity_cancellations']
                        })
                    });

                    const result = await response.json();

                    if (response.ok) {
                        alert('🤖 Disruption monitoring activated! You\'ll be notified of any changes to your trip.');
                        // Start periodic checks (in production, this would use WebSockets or Server-Sent Events)
                        setInterval(checkForDisruptions, 60000); // Check every minute
                    } else {
                        throw new Error(result.error || 'Failed to start monitoring');
                    }
                } catch (error) {
                    console.error('Monitoring setup error:', error);
                    alert('❌ Failed to setup disruption monitoring. Please try again.');
                }
            };

            const checkForDisruptions = async () => {
                try {
                    // Simulate disruption checking
                    const randomCheck = Math.random();
                    if (randomCheck < 0.02) { // 2% chance of disruption for demo
                        showDisruptionAlert();
                    }
                } catch (error) {
                    console.error('Disruption check error:', error);
                }
            };

            const showDisruptionAlert = () => {
                const disruptions = [
                    '⚠️ Flight AA1234 delayed by 30 minutes due to air traffic.',
                    '🌧️ Weather alert: Light rain expected in Paris. Indoor activities recommended.',
                    '🚧 Metro Line 1 experiencing delays. Allow extra travel time.',
                    '📞 Hotel Paris confirms early check-in available at 2:00 PM.'
                ];

                const randomDisruption = disruptions[Math.floor(Math.random() * disruptions.length)];

                // Create notification
                if (Notification.permission === 'granted') {
                    new Notification('TravelMaster AI Alert', {
                        body: randomDisruption,
                        icon: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80'
                    });
                } else {
                    alert(`🤖 TravelMaster AI Alert:\n\n${randomDisruption}`);
                }
            };

            // Request notification permissions
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }

            // Trip booking and management functions
            const bookTrip = async () => {
                setIsLoading(true);
                try {
                    // Generate trip ID
                    const tripId = `TRIP_${Date.now()}`;
                    const bookingConfirmation = `CONF_${tripId}`;

                    // Create new trip object
                    const newTrip = {
                        trip_id: tripId,
                        destination: itinerary?.request?.destination || 'Unknown Destination',
                        start_date: itinerary?.request?.start_date || '',
                        end_date: itinerary?.request?.end_date || '',
                        status: 'confirmed',
                        booking_date: new Date().toISOString(),
                        budget: itinerary?.request?.budget || 0,
                        travelers: itinerary?.request?.travelers || 1,
                        trip_data: {
                            basic_itinerary: itinerary,
                            comprehensive_itinerary: comprehensiveItinerary,
                            special_instructions: travelRequest.special_requirements || "Create a memorable travel experience"
                        }
                    };

                    // Add to trips list
                    const updatedTrips = [...userTrips, newTrip];
                    setUserTrips(updatedTrips);

                    // Store in localStorage for persistence
                    localStorage.setItem('travelmaster_trips', JSON.stringify(updatedTrips));

                    // Clear current trip data
                    setItinerary(null);
                    setComprehensiveItinerary(null);

                    // Navigate directly to trips dashboard
                    setCurrentStep('trips');

                    // Show success message
                    setTimeout(() => {
                        alert(`🎉 Trip Submitted Successfully!\n\nTrip ID: ${tripId}\nConfirmation: ${bookingConfirmation}\n\nYour trip is now available in your dashboard! Click on the trip card to view calendar and wallet.`);
                    }, 500);

                } catch (error) {
                    console.error('Trip submission error:', error);
                    alert(`❌ Failed to submit trip: ${error.message}\n\nPlease try again.`);
                } finally {
                    setIsLoading(false);
                }
            };

            const loadUserTrips = async () => {
                try {
                    console.log('Loading user trips from localStorage...');
                    const storedTrips = localStorage.getItem('travelmaster_trips');
                    if (storedTrips) {
                        const trips = JSON.parse(storedTrips);
                        console.log('Loaded trips:', trips);
                        setUserTrips(trips || []);
                    } else {
                        setUserTrips([]);
                    }
                } catch (error) {
                    console.error('Failed to load trips:', error);
                    setUserTrips([]);
                }
            };

            const loadTripDetails = async (tripId) => {
                try {
                    const trip = userTrips.find(t => t.trip_id === tripId);
                    if (trip) {
                        setSelectedTrip(trip);
                        setCurrentStep('dashboard');
                    } else {
                        alert('Trip not found');
                    }
                } catch (error) {
                    console.error('Failed to load trip details:', error);
                    alert('Failed to load trip details');
                }
            };

            const cancelTrip = async (tripId) => {
                if (confirm('Are you sure you want to cancel this trip? This action cannot be undone.')) {
                    try {
                        // Update trip status to cancelled
                        const updatedTrips = userTrips.map(trip =>
                            trip.trip_id === tripId
                                ? { ...trip, status: 'cancelled', cancellation_date: new Date().toISOString() }
                                : trip
                        );

                        setUserTrips(updatedTrips);
                        localStorage.setItem('travelmaster_trips', JSON.stringify(updatedTrips));

                        alert('Trip cancelled successfully');
                        setCurrentStep('trips');
                    } catch (error) {
                        console.error('Failed to cancel trip:', error);
                        alert('Failed to cancel trip');
                    }
                }
            };

            // Disruption simulation and rescheduling
            const [isRescheduling, setIsRescheduling] = useState(false);
            const [rescheduleChanges, setRescheduleChanges] = useState([]);
            const [currentDisruption, setCurrentDisruption] = useState(null);





            const updateStoredTrip = (updatedTrip) => {
                const trips = JSON.parse(localStorage.getItem('travelmaster_trips') || '[]');
                const tripIndex = trips.findIndex(t => t.trip_id === updatedTrip.trip_id);
                if (tripIndex !== -1) {
                    trips[tripIndex] = updatedTrip;
                    localStorage.setItem('travelmaster_trips', JSON.stringify(trips));
                    setUserTrips(trips);
                }
            };

            // Load trips on component mount
            React.useEffect(() => {
                loadUserTrips();
            }, []);

            // Plan trip function
            const planTrip = async () => {
                setIsLoading(true);
                try {
                    // Collect data from refs to avoid focus issues
                    const requestData = {
                        destination: destinationRef.current?.value || '',
                        departure_location: departureRef.current?.value || '',
                        start_date: startDateRef.current?.value || '',
                        end_date: endDateRef.current?.value || '',
                        budget: parseFloat(budgetRef.current?.value) || 0,
                        travelers: parseInt(travelersRef.current?.value) || 1,
                        preferences: Array.from(preferencesRef.current),
                        special_requirements: specialReqRef.current?.value || ''
                    };

                    // Prepare headers with authentication if available
                    const headers = {
                        'Content-Type': 'application/json',
                    };

                    if (accessToken) {
                        headers['Authorization'] = `Bearer ${accessToken}`;
                    }

                    const response = await fetch('http://localhost:8000/api/plan-trip', {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify(requestData),
                    });

                    if (response.ok) {
                        const result = await response.json();
                        setItinerary(result);

                        // Generate comprehensive AI itinerary with Gemini
                        try {
                            console.log('🤖 Generating comprehensive AI itinerary...');
                            const comprehensiveHeaders = {
                                'Content-Type': 'application/json',
                            };

                            if (accessToken) {
                                comprehensiveHeaders['Authorization'] = `Bearer ${accessToken}`;
                            }

                            const comprehensiveResponse = await fetch('http://localhost:8000/api/generate-itinerary', {
                                method: 'POST',
                                headers: comprehensiveHeaders,
                                body: JSON.stringify({
                                    trip_data: result,
                                    special_instructions: requestData.special_requirements || "Create a memorable and well-organized travel experience."
                                }),
                            });

                            if (comprehensiveResponse.ok) {
                                const comprehensiveResult = await comprehensiveResponse.json();
                                console.log('✅ Comprehensive itinerary generated:', comprehensiveResult);

                                // Store comprehensive data
                                setComprehensiveItinerary(comprehensiveResult);

                                // Show success message
                                setTimeout(() => {
                                    alert('🤖 AI Enhancement Complete!\n\nYour trip has been enhanced with:\n• Daily calendar timeline\n• Smart reservations hub\n• Disruption monitoring\n• Emergency contacts');
                                }, 1000);
                            } else {
                                console.warn('Failed to generate comprehensive itinerary, using basic version');
                            }
                        } catch (aiError) {
                            console.error('AI enhancement error:', aiError);
                            console.log('Continuing with basic itinerary');
                        }

                        setCurrentStep('results');
                    } else {
                        throw new Error('Failed to plan trip');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Failed to plan trip. Please try again.');
                } finally {
                    setIsLoading(false);
                }
            };

            // Authentication Component
            const AuthComponent = () => (
                <div className="glass-effect rounded-2xl p-8 shadow-2xl max-w-md w-full mx-auto">
                    <div className="text-center">
                        <div className="mb-6">
                            <i className="fas fa-passport text-6xl text-blue-500 mb-4"></i>
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Welcome to TravelMaster</h1>
                            <p className="text-gray-600">Sign in to plan your perfect trip with AI</p>
                        </div>

                        {authLoading ? (
                            <div className="text-center py-8">
                                <i className="fas fa-spinner fa-spin text-3xl text-blue-500 mb-4"></i>
                                <p className="text-gray-600">Loading authentication...</p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <button
                                    onClick={login}
                                    className="w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg"
                                >
                                    <i className="fas fa-sign-in-alt mr-2"></i>
                                    Sign In
                                </button>

                                <button
                                    onClick={signup}
                                    className="w-full px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all shadow-lg"
                                >
                                    <i className="fas fa-user-plus mr-2"></i>
                                    Create Account
                                </button>

                                <div className="text-center mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                    <p className="text-sm text-blue-700 mb-2">
                                        <i className="fas fa-rocket mr-1"></i>
                                        Ready to explore the world with AI?
                                    </p>
                                    <button
                                        onClick={() => {
                                            setCurrentStep('trips');
                                            setIsAuthenticated(true);
                                            setUser({ name: 'Demo User', email: 'demo@travelmaster.ai' });
                                        }}
                                        className="mt-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 shadow-lg transition-all transform hover:-translate-y-1"
                                    >
                                        <i className="fas fa-plane mr-2"></i>Start Planning Your Adventure
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="mt-8 pt-6 border-t border-gray-200">
                            <div className="flex justify-center space-x-6 text-sm text-gray-500">
                                <span><i className="fas fa-shield-alt mr-1"></i>Secure Auth0 Login</span>
                                <span><i className="fas fa-globe mr-1"></i>Universal Access</span>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Planning Form Component
            const PlanningForm = () => (
                <div className="glass-effect rounded-2xl p-8 shadow-2xl max-w-4xl w-full">
                    <div className="hackathon-header">
                        <h1 className="text-4xl font-bold mb-4">
                            🌍 TravelMaster AI
                        </h1>
                        <p className="text-xl opacity-90">
                            Plan your perfect trip with AI-powered recommendations
                        </p>
                        <div className="mt-4 flex justify-center space-x-6 text-sm">
                            <span><i className="fas fa-robot mr-1"></i>Smart Planning</span>
                            <span><i className="fas fa-dollar-sign mr-1"></i>Budget Aware</span>
                            <span><i className="fas fa-microphone mr-1"></i>Voice Enabled</span>
                            {isAuthenticated && <span><i className="fas fa-shield-alt mr-1"></i>Authenticated</span>}
                        </div>

                        {/* User Info Bar */}
                        {isAuthenticated && user && (
                            <div className="mt-4 bg-white bg-opacity-20 rounded-lg p-3 flex justify-between items-center">
                                <div className="flex items-center">
                                    <img
                                        src={user.picture}
                                        alt={user.name}
                                        className="w-8 h-8 rounded-full mr-3"
                                        onError={(e) => { e.target.src = 'https://via.placeholder.com/32x32?text=👤' }}
                                    />
                                    <span className="text-white font-medium">Welcome, {user.name || user.email}</span>
                                </div>
                                <button
                                    onClick={logout}
                                    className="px-3 py-1 bg-red-500 bg-opacity-70 text-white rounded-md hover:bg-opacity-90 transition-all text-sm"
                                >
                                    <i className="fas fa-sign-out-alt mr-1"></i>Logout
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Form Fields */}
                    <div className="grid md:grid-cols-2 gap-6">
                        {/* Destination */}
                        <div>
                            <label className="block text-gray-700 font-semibold mb-2">
                                <i className="fas fa-map-marker-alt mr-2"></i>Destination
                            </label>
                            <input
                                ref={destinationRef}
                                type="text"
                                defaultValue={travelRequest.destination}
                                placeholder="Where do you want to go?"
                                className="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>

                        {/* Departure Location */}
                        <div>
                            <label className="block text-gray-700 font-semibold mb-2">
                                <i className="fas fa-plane-departure mr-2"></i>Departure Location
                            </label>
                            <input
                                ref={departureRef}
                                type="text"
                                defaultValue={travelRequest.departure_location}
                                placeholder="Where are you leaving from?"
                                className="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>

                        {/* Start Date */}
                        <div>
                            <label className="block text-gray-700 font-semibold mb-2">
                                <i className="fas fa-calendar-alt mr-2"></i>Start Date
                            </label>
                            <input
                                ref={startDateRef}
                                type="date"
                                defaultValue={travelRequest.start_date}
                                className="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>

                        {/* End Date */}
                        <div>
                            <label className="block text-gray-700 font-semibold mb-2">
                                <i className="fas fa-calendar-check mr-2"></i>End Date
                            </label>
                            <input
                                ref={endDateRef}
                                type="date"
                                defaultValue={travelRequest.end_date}
                                className="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>

                        {/* Budget */}
                        <div>
                            <label className="block text-gray-700 font-semibold mb-2">
                                <i className="fas fa-dollar-sign mr-2"></i>Budget (USD)
                            </label>
                            <input
                                ref={budgetRef}
                                type="number"
                                defaultValue={travelRequest.budget || ''}
                                placeholder="Total budget"
                                className="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>

                        {/* Travelers */}
                        <div>
                            <label className="block text-gray-700 font-semibold mb-2">
                                <i className="fas fa-users mr-2"></i>Travelers
                            </label>
                            <select
                                ref={travelersRef}
                                defaultValue={travelRequest.travelers}
                                className="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                {[1, 2, 3, 4, 5, 6].map(num => (
                                    <option key={num} value={num}>{num} {num === 1 ? 'Person' : 'People'}</option>
                                ))}
                            </select>
                        </div>
                    </div>

                    {/* Preferences */}
                    <div className="mt-6">
                        <label className="block text-gray-700 font-semibold mb-4">
                            <i className="fas fa-heart mr-2"></i>Travel Preferences
                        </label>
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                            {['budget', 'mid_range', 'luxury', 'adventure', 'relaxation', 'cultural'].map(pref => (
                                <label key={pref} className="flex items-center cursor-pointer">
                                    <input
                                        type="checkbox"
                                        name="preferences"
                                        value={pref}
                                        defaultChecked={travelRequest.preferences.includes(pref)}
                                        onChange={(e) => {
                                            if (e.target.checked) {
                                                preferencesRef.current.add(pref);
                                            } else {
                                                preferencesRef.current.delete(pref);
                                            }
                                        }}
                                        className="mr-2"
                                    />
                                    <span className="text-gray-700 capitalize">{pref.replace('_', ' ')}</span>
                                </label>
                            ))}
                        </div>
                    </div>

                    {/* Special Requirements */}
                    <div className="mt-6">
                        <label className="block text-gray-700 font-semibold mb-2">
                            <i className="fas fa-info-circle mr-2"></i>Special Requirements
                        </label>
                        <textarea
                            ref={specialReqRef}
                            defaultValue={travelRequest.special_requirements}
                            placeholder="Any special requests or requirements?"
                            rows="3"
                            className="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        ></textarea>
                    </div>

                    {/* Action Buttons */}
                    <div className="flex gap-4 mt-8 justify-center">
                        <button
                            onClick={startVoiceRecognition}
                            className={`px-8 py-4 rounded-lg font-semibold transition-all shadow-lg ${isListening
                                ? 'bg-red-500 text-white voice-pulse'
                                : 'bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700'
                                }`}
                        >
                            <i className={`fas ${isListening ? 'fa-stop' : 'fa-microphone'} mr-2`}></i>
                            {isListening ? 'Stop Recording' : '🎤 Voice Planning'}
                        </button>

                        <button
                            onClick={planTrip}
                            disabled={isLoading}
                            className="px-8 py-4 bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                        >
                            {isLoading ? (
                                <>
                                    <i className="fas fa-spinner fa-spin mr-2"></i>
                                    🤖 AI Planning Your Trip...
                                </>
                            ) : (
                                <>
                                    <i className="fas fa-brain mr-2"></i>
                                    🚀 Plan with AI
                                </>
                            )}
                        </button>
                    </div>
                </div>
            );

            const ResultsDisplay = () => (
                <div className="glass-effect rounded-2xl p-8 shadow-2xl max-w-6xl w-full">
                    {/* Hackathon Header */}
                    <div className="hackathon-header mb-8">
                        <h1 className="text-4xl font-bold mb-4">🏆 TravelMaster AI</h1>
                        <p className="text-xl opacity-90">Intelligent Budget-Aware Travel Planning</p>
                        <div className="mt-4 flex justify-center space-x-6 text-sm">
                            <span><i className="fas fa-brain mr-1"></i>AI-Powered</span>
                            <span><i className="fas fa-chart-line mr-1"></i>Budget Optimized</span>
                            <span><i className="fas fa-globe mr-1"></i>Global Coverage</span>
                        </div>
                    </div>

                    {/* Destination Preview */}
                    <div className="destination-preview mb-8 relative">
                        <img
                            src={getDestinationImage(itinerary?.request?.destination)}
                            alt={itinerary?.request?.destination}
                            className="w-full h-full object-cover"
                            style={{ filter: 'brightness(0.7)' }}
                            onError={(e) => {
                                e.target.src = 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80';
                            }}
                        />
                        <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30">
                            <div className="text-center text-white">
                                <h2 className="text-5xl font-bold mb-3">
                                    Welcome to {itinerary?.request?.destination}
                                </h2>
                                <p className="text-2xl opacity-90 mb-4">Your AI-Planned Adventure Awaits!</p>
                                <div className="flex justify-center space-x-6 text-lg">
                                    <span><i className="fas fa-calendar mr-2"></i>{(itinerary?.end_date && itinerary?.start_date) ? Math.ceil((new Date(itinerary.end_date) - new Date(itinerary.start_date)) / (1000 * 60 * 60 * 24)) : 'N/A'} Days</span>
                                    <span><i className="fas fa-users mr-2"></i>{itinerary?.request?.travelers} Travelers</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Smart Budget Analytics */}
                    <div className="mb-8">
                        <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">
                            📊 Smart Budget Analytics
                        </h2>
                        <div className="grid md:grid-cols-4 gap-4">
                            <div className="stat-card">
                                <i className="fas fa-calendar-alt text-3xl text-blue-500 mb-3"></i>
                                <div className="font-semibold text-gray-600">Trip Duration</div>
                                <div className="text-2xl font-bold text-gray-800">
                                    {(itinerary?.request?.end_date && itinerary?.request?.start_date) ?
                                        Math.ceil((new Date(itinerary.request.end_date) - new Date(itinerary.request.start_date)) / (1000 * 60 * 60 * 24)) : 'N/A'} Days
                                </div>
                                <div className="text-sm text-gray-500 mt-1">
                                    {new Date(itinerary?.request?.start_date).toLocaleDateString()} - {new Date(itinerary?.request?.end_date).toLocaleDateString()}
                                </div>
                            </div>
                            <div className="stat-card">
                                <i className="fas fa-wallet text-3xl text-purple-500 mb-3"></i>
                                <div className="font-semibold text-gray-600">Budget Used</div>
                                <div className="text-2xl font-bold text-gray-800">${parseFloat(itinerary?.total_cost || 0).toFixed(2)}</div>
                                <div className="text-sm text-purple-600 mt-1">
                                    {((parseFloat(itinerary?.total_cost || 0) / parseFloat(itinerary?.request?.budget || 1)) * 100).toFixed(1)}% of ${parseFloat(itinerary?.request?.budget || 0).toFixed(0)}
                                </div>
                            </div>
                            <div className="stat-card">
                                <i className="fas fa-piggy-bank text-3xl text-green-500 mb-3"></i>
                                <div className="font-semibold text-gray-600">Money Saved</div>
                                <div className="text-2xl font-bold text-green-600">${parseFloat(itinerary?.savings || 0).toFixed(2)}</div>
                                <div className="text-sm text-green-500 mt-1">
                                    {((parseFloat(itinerary?.savings || 0) / parseFloat(itinerary?.request?.budget || 1)) * 100).toFixed(1)}% under budget!
                                </div>
                            </div>
                            <div className="stat-card">
                                <i className="fas fa-star text-3xl text-yellow-500 mb-3"></i>
                                <div className="font-semibold text-gray-600">AI Score</div>
                                <div className="text-2xl font-bold text-yellow-600">
                                    {Math.min(99, Math.max(85, 95 - (parseFloat(itinerary?.total_cost || 0) / parseFloat(itinerary?.request?.budget || 1)) * 10)).toFixed(0)}/100
                                </div>
                                <div className="text-sm text-yellow-500 mt-1">Optimization Rating</div>
                            </div>
                        </div>
                    </div>

                    {/* Flights */}
                    <div className="mb-8">
                        <h3 className="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                            <i className="fas fa-plane mr-3 text-blue-500"></i>✈️ Flights
                        </h3>
                        <div className="space-y-6">
                            {itinerary?.flights?.map((flight, idx) => (
                                <div key={idx} className="travel-card p-6">
                                    <div className="flex justify-between items-start mb-4">
                                        <div className="flex-1">
                                            <div className="flex items-center mb-2">
                                                <span className="flight-number">{flight.flight_number || `FL${idx + 1}001`}</span>
                                                <span className="font-semibold text-lg text-gray-800">{flight.airline}</span>
                                            </div>
                                            <div className="text-sm text-gray-600 mb-2">
                                                <i className="fas fa-plane mr-2 text-blue-500"></i>
                                                {flight.aircraft || 'Commercial Aircraft'} • {flight.duration} • {flight.stops === 0 ? 'Nonstop' : `${flight.stops} stop${flight.stops > 1 ? 's' : ''}`}
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="font-bold text-2xl text-gray-800">${parseFloat(flight.price || 0).toFixed(0)}</div>
                                            <div className="text-sm text-gray-500">{flight.booking_class || 'Economy'}</div>
                                        </div>
                                    </div>

                                    {/* Airport Information */}
                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div className="airport-info">
                                            <div className="font-semibold text-xs text-gray-500">DEPARTURE</div>
                                            <div className="font-bold text-gray-700">{flight.departure_airport || 'LAX'} - {flight.departure_airport_name || 'Los Angeles Intl'}</div>
                                            <div className="text-sm text-gray-600">{new Date(flight.departure_time).toLocaleString()}</div>
                                        </div>
                                        <div className="airport-info">
                                            <div className="font-semibold text-xs text-gray-500">ARRIVAL</div>
                                            <div className="font-bold text-gray-700">{flight.arrival_airport || 'JFK'} - {flight.arrival_airport_name || 'John F Kennedy Intl'}</div>
                                            <div className="text-sm text-gray-600">{new Date(flight.arrival_time).toLocaleString()}</div>
                                        </div>
                                    </div>

                                    <div className="text-sm text-gray-600 flex justify-between items-center">
                                        <span><i className="fas fa-users mr-1 text-green-500"></i>{flight.available_seats || '12'} seats available</span>
                                        <span><i className="fas fa-check-circle mr-1 text-blue-500"></i>Instant confirmation</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Hotels */}
                    <div className="mb-8">
                        <h3 className="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                            <i className="fas fa-bed mr-3 text-blue-300"></i>🏨 Hotels & Accommodation
                        </h3>
                        <div className="space-y-6">
                            {itinerary?.hotels?.map((hotel, idx) => (
                                <div key={idx} className="travel-card p-0 overflow-hidden">
                                    <img
                                        src={getHotelImage(hotel.name, idx)}
                                        alt={hotel.name}
                                        className="hotel-image"
                                        onError={(e) => {
                                            e.target.src = 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80';
                                        }}
                                    />
                                    <div className="p-6">
                                        <div className="flex justify-between items-start mb-4">
                                            <div className="flex-1">
                                                <div className="font-bold text-xl text-gray-800 mb-2">{hotel.name}</div>
                                                <div className="flex items-center mb-2">
                                                    <div className="flex text-yellow-400 mr-2">
                                                        {[...Array(Math.floor(hotel.rating))].map((_, i) => (
                                                            <i key={i} className="fas fa-star text-sm"></i>
                                                        ))}
                                                        {hotel.rating % 1 !== 0 && <i className="fas fa-star-half-alt text-sm"></i>}
                                                    </div>
                                                    <span className="text-sm text-gray-600">{hotel.rating} rating</span>
                                                </div>
                                                <div className="airport-info inline-block">
                                                    <i className="fas fa-map-marker-alt mr-1"></i>{hotel.location}
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <div className="font-bold text-2xl text-gray-800">${parseFloat(hotel.total_price || 0).toFixed(0)}</div>
                                                <div className="text-sm text-gray-500">${parseFloat(hotel.price_per_night || 0).toFixed(0)}/night</div>
                                            </div>
                                        </div>
                                        <div className="text-gray-600 text-sm mb-3">
                                            <i className="fas fa-concierge-bell mr-2"></i>
                                            {hotel.amenities?.slice(0, 6).join(' • ')}
                                        </div>
                                        <div className="flex justify-between items-center text-sm">
                                            <span className="text-green-600">
                                                <i className="fas fa-check-circle mr-1"></i>Free cancellation
                                            </span>
                                            <span className="text-blue-600">
                                                <i className="fas fa-wifi mr-1"></i>Free WiFi included
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Activities */}
                    <div className="mb-8">
                        <h3 className="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                            <i className="fas fa-compass mr-3 text-purple-300"></i>🎯 Activities & Experiences
                        </h3>
                        <div className="grid md:grid-cols-2 gap-6">
                            {itinerary?.activities?.map((activity, idx) => (
                                <div key={idx} className="travel-card p-0 overflow-hidden">
                                    <img
                                        src={getActivityImage(activity.name, idx)}
                                        alt={activity.name}
                                        className="w-full h-48 object-cover"
                                        onError={(e) => {
                                            e.target.src = 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80';
                                        }}
                                    />
                                    <div className="p-5">
                                        <div className="font-bold text-lg text-gray-800 mb-2">{activity.name}</div>
                                        <div className="flex items-center mb-3">
                                            <div className="flex text-yellow-400 mr-2">
                                                {[...Array(Math.floor(activity.rating))].map((_, i) => (
                                                    <i key={i} className="fas fa-star text-sm"></i>
                                                ))}
                                                {activity.rating % 1 !== 0 && <i className="fas fa-star-half-alt text-sm"></i>}
                                            </div>
                                            <span className="text-sm text-gray-600 mr-3">{activity.rating}</span>
                                            <span className="airport-info">
                                                <i className="fas fa-clock mr-1"></i>{activity.duration}
                                            </span>
                                        </div>
                                        <div className="text-sm text-gray-600 mb-4 leading-relaxed">{activity.description}</div>
                                        <div className="flex justify-between items-center">
                                            <div className="font-bold text-xl text-gray-800">${parseFloat(activity.price || 0).toFixed(0)}</div>
                                            <div className="text-sm text-gray-500">
                                                <i className="fas fa-ticket-alt mr-1"></i>per person
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Restaurants */}
                    <div className="mb-8">
                        <h3 className="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                            <i className="fas fa-utensils mr-3 text-orange-300"></i>🍽️ Highly Rated Restaurants
                        </h3>
                        <div className="grid md:grid-cols-2 gap-6">
                            {itinerary?.restaurants?.map((restaurant, idx) => (
                                <div key={idx} className="travel-card p-0 overflow-hidden">
                                    <img
                                        src={getRestaurantImage(restaurant.name, idx)}
                                        alt={restaurant.name}
                                        className="w-full h-48 object-cover"
                                        onError={(e) => {
                                            e.target.src = 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80';
                                        }}
                                    />
                                    <div className="p-5">
                                        <div className="font-bold text-lg text-gray-800 mb-2">{restaurant.name}</div>
                                        <div className="flex items-center mb-3">
                                            <div className="flex text-yellow-400 mr-2">
                                                {[...Array(Math.floor(restaurant.rating))].map((_, i) => (
                                                    <i key={i} className="fas fa-star text-sm"></i>
                                                ))}
                                                {restaurant.rating % 1 !== 0 && <i className="fas fa-star-half-alt text-sm"></i>}
                                            </div>
                                            <span className="text-sm text-gray-600 mr-3">{restaurant.rating}</span>
                                            <span className="airport-info">
                                                <i className="fas fa-users mr-1"></i>{restaurant.reviews_count} reviews
                                            </span>
                                        </div>
                                        <div className="text-sm text-gray-600 mb-2">
                                            <i className="fas fa-map-marker-alt mr-2 text-red-400"></i>
                                            {restaurant.address}
                                        </div>
                                        <div className="text-sm text-blue-600 mb-3">
                                            <i className="fas fa-utensils mr-2"></i>
                                            {restaurant.cuisine_types?.join(', ') || 'International'}
                                        </div>
                                        <div className="text-xs text-gray-500 mb-3">
                                            {restaurant.specialties?.slice(0, 2).join(' • ')}
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <div className="font-bold text-xl text-gray-800">
                                                ${parseFloat(restaurant.estimated_cost || 0).toFixed(0)}
                                            </div>
                                            <div className="text-sm text-gray-500">
                                                <div className="flex items-center">
                                                    {[...Array(restaurant.price_level || 2)].map((_, i) => (
                                                        <span key={i} className="text-green-500">$</span>
                                                    ))}
                                                    <span className="ml-1">avg per meal</span>
                                                </div>
                                            </div>
                                        </div>
                                        {restaurant.opening_hours?.length > 0 && (
                                            <div className="text-xs text-gray-500 mt-2">
                                                <i className="fas fa-clock mr-1"></i>
                                                {restaurant.opening_hours[0]}
                                            </div>
                                        )}
                                        {restaurant.phone && (
                                            <div className="text-xs text-blue-500 mt-1">
                                                <i className="fas fa-phone mr-1"></i>
                                                {restaurant.phone}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="mt-8 text-center">
                        <button
                            onClick={bookTrip}
                            disabled={isLoading}
                            className="px-8 py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-bold hover:from-green-600 hover:to-emerald-700 shadow-xl transform hover:scale-105 transition-all disabled:opacity-50"
                        >
                            {isLoading ? (
                                <>
                                    <i className="fas fa-spinner fa-spin mr-2"></i>
                                    � Submitting Trip...
                                </>
                            ) : (
                                <>
                                    <i className="fas fa-check mr-2"></i>✅ Submit Trip to Dashboard
                                </>
                            )}
                        </button>
                    </div>
                </div>
            );

            // Booking confirmation component
            const BookingConfirmation = () => (
                <div className="glass-effect rounded-2xl p-8 shadow-2xl max-w-4xl w-full text-center">
                    <div className="mb-8">
                        <div className="text-6xl mb-4">🎉</div>
                        <h1 className="text-4xl font-bold mb-4 text-green-600">Trip Booked Successfully!</h1>
                        <div className="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
                            <h2 className="text-xl font-semibold mb-2">Booking Details</h2>
                            <p><strong>Trip ID:</strong> {bookedTrip?.trip_id}</p>
                            <p><strong>Confirmation:</strong> {bookedTrip?.booking_confirmation}</p>
                            <p><strong>Destination:</strong> {itinerary?.request?.destination}</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        <button
                            onClick={() => {
                                setSelectedTrip({trip_id: bookedTrip?.trip_id, trip_data: {basic_itinerary: itinerary, comprehensive_itinerary: comprehensiveItinerary}, status: 'confirmed'});
                                setCurrentStep('dashboard');
                            }}
                            className="px-6 py-4 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 shadow-lg"
                        >
                            <i className="fas fa-calendar-alt mr-2"></i>View Calendar & Wallet
                        </button>
                        <button
                            onClick={() => setCurrentStep('trips')}
                            className="px-6 py-4 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 shadow-lg"
                        >
                            <i className="fas fa-tachometer-alt mr-2"></i>Go to Dashboard
                        </button>
                    </div>
                </div>
            );

            // Trips list component
            const TripsListView = () => (
                <div className="glass-effect rounded-2xl p-8 shadow-2xl max-w-6xl w-full">
                    <div className="text-center mb-8">
                        <h1 className="text-4xl font-bold mb-4">🏠 Trip Dashboard</h1>
                        <p className="text-xl text-gray-600">Manage your travel adventures</p>
                    </div>

                    <div className="mb-6">
                        <h2 className="text-2xl font-semibold">Your Trips ({userTrips.length})</h2>
                        <p className="text-gray-600 mt-2">Select a trip to view calendar, reservations, and monitoring</p>
                    </div>

                    {userTrips.length === 0 ? (
                        <div className="text-center py-12">
                            <div className="text-6xl mb-4">✈️</div>
                            <h3 className="text-2xl font-semibold mb-4">No trips yet</h3>
                            <p className="text-gray-600 mb-6">Start planning your first adventure!</p>
                            <button
                                onClick={() => setCurrentStep('planning')}
                                className="px-8 py-4 bg-gradient-to-r from-blue-500 to-teal-600 text-white rounded-lg font-bold hover:from-blue-600 hover:to-teal-700 shadow-xl"
                            >
                                Plan Your First Trip
                            </button>
                        </div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {userTrips.map(trip => (
                                <div key={trip.trip_id} className="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow">
                                    <div className="h-48 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                                        <div className="text-center text-white">
                                            <div className="text-4xl mb-2">🌍</div>
                                            <h3 className="text-xl font-bold">{trip.destination}</h3>
                                        </div>
                                    </div>

                                    <div className="p-6">
                                        <div className="flex justify-between items-start mb-4">
                                            <div>
                                                <p className="text-sm text-gray-600">Dates</p>
                                                <p className="font-semibold">{trip.start_date} - {trip.end_date}</p>
                                            </div>
                                            <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                trip.status === 'confirmed' ? 'bg-green-100 text-green-800' :
                                                trip.status === 'cancelled' ? 'bg-red-100 text-red-800' :
                                                'bg-gray-100 text-gray-800'
                                            }`}>
                                                {trip.status.toUpperCase()}
                                            </span>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4 mb-4 text-sm">
                                            <div>
                                                <p className="text-gray-600">Budget</p>
                                                <p className="font-semibold">${trip.budget}</p>
                                            </div>
                                            <div>
                                                <p className="text-gray-600">Travelers</p>
                                                <p className="font-semibold">{trip.travelers} people</p>
                                            </div>
                                        </div>

                                        <div className="flex space-x-2">
                                            <button
                                                onClick={() => loadTripDetails(trip.trip_id)}
                                                className="flex-1 px-4 py-2 bg-blue-500 text-white rounded font-semibold hover:bg-blue-600 transition-colors"
                                            >
                                                <i className="fas fa-eye mr-1"></i>View
                                            </button>
                                            {trip.status === 'confirmed' && (
                                                <button
                                                    onClick={() => cancelTrip(trip.trip_id)}
                                                    className="px-4 py-2 bg-red-500 text-white rounded font-semibold hover:bg-red-600 transition-colors"
                                                >
                                                    <i className="fas fa-times"></i>
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );

            // Trip Dashboard component
            const TripDashboard = () => {
                if (!selectedTrip) return <div>Loading...</div>;

                const tripData = selectedTrip.trip_data;
                const itinerary = tripData.basic_itinerary || tripData.comprehensive_itinerary;

                // Helper function to format date
                const formatDate = (dateStr) => {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                };

                // Helper function to format time
                const formatTime = (dateStr) => {
                    const date = new Date(dateStr);
                    return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                };

                // Generate calendar days from trip data
                const generateCalendarDays = () => {
                    const startDate = new Date(itinerary?.request?.start_date);
                    const endDate = new Date(itinerary?.request?.end_date);
                    const days = [];

                    for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                        const dayStr = d.toISOString().split('T')[0];
                        const dayEvents = [];

                        // Add flights for departure day
                        if (d.getTime() === startDate.getTime() && itinerary?.flights?.length > 0) {
                            const outboundFlight = itinerary.flights.find(f => f.departure_time?.includes(dayStr) || f.flight_id?.includes('outbound'));
                            if (outboundFlight) {
                                dayEvents.push({
                                    time: formatTime(outboundFlight.departure_time || `${dayStr}T08:00:00`),
                                    duration: '2-3h',
                                    event: `Flight ${outboundFlight.flight_id || 'Departure'}`,
                                    location: `${outboundFlight.departure_airport || 'Departure'} → ${outboundFlight.arrival_airport || 'Arrival'}`,
                                    icon: '✈️'
                                });
                            }
                        }

                        // Add hotel check-in on first day
                        if (d.getTime() === startDate.getTime() && itinerary?.hotels?.length > 0) {
                            const hotel = itinerary.hotels[0];
                            dayEvents.push({
                                time: '15:00',
                                duration: '30min',
                                event: 'Hotel Check-in',
                                location: hotel.name || 'Hotel',
                                icon: '🏨'
                            });
                        }

                        // Add restaurants (distribute across days)
                        const dayIndex = Math.floor((d.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));
                        if (itinerary?.restaurants?.length > dayIndex) {
                            const restaurant = itinerary.restaurants[dayIndex];
                            dayEvents.push({
                                time: '19:00',
                                duration: '1.5h',
                                event: `Dinner at ${restaurant.name}`,
                                location: restaurant.address || restaurant.location || 'Restaurant location',
                                icon: '🍽️'
                            });
                        }

                        // Add activities (distribute across days)
                        if (itinerary?.activities?.length > dayIndex) {
                            const activity = itinerary.activities[dayIndex];
                            dayEvents.push({
                                time: '10:00',
                                duration: activity.duration || '2h',
                                event: activity.name || activity.title,
                                location: activity.location || 'Activity location',
                                icon: activity.category === 'sightseeing' ? '👁️' : '🎪'
                            });
                        }

                        // Add return flight on last day
                        if (d.getTime() === endDate.getTime() && itinerary?.flights?.length > 1) {
                            const returnFlight = itinerary.flights.find(f => f.flight_id?.includes('return') || itinerary.flights.indexOf(f) === 1);
                            if (returnFlight) {
                                dayEvents.push({
                                    time: formatTime(returnFlight.departure_time || `${dayStr}T16:00:00`),
                                    duration: '2-3h',
                                    event: `Return Flight ${returnFlight.flight_id}`,
                                    location: `${returnFlight.departure_airport} → ${returnFlight.arrival_airport}`,
                                    icon: '✈️'
                                });
                            }
                        }

                        if (dayEvents.length > 0) {
                            days.push({
                                date: dayStr,
                                formatted: formatDate(d),
                                events: dayEvents.sort((a, b) => a.time.localeCompare(b.time))
                            });
                        }
                    }
                    return days;
                };

                const calendarDays = generateCalendarDays();

                return (
                    <div className="glass-effect rounded-2xl p-8 shadow-2xl max-w-6xl w-full">
                        {/* Header */}
                        <div className="mb-8">
                            <button
                                onClick={() => setCurrentStep('trips')}
                                className="mb-4 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                            >
                                <i className="fas fa-arrow-left mr-2"></i>Back to Dashboard
                            </button>
                            <div className="flex justify-between items-start">
                                <div>
                                    <h1 className="text-4xl font-bold mb-2">📍 {itinerary?.request?.destination}</h1>
                                    <p className="text-gray-600">Trip ID: {selectedTrip.trip_id} • Status: {selectedTrip.status?.toUpperCase()}</p>
                                    <p className="text-sm text-gray-500 mt-1">
                                        {formatDate(itinerary?.request?.start_date)} - {formatDate(itinerary?.request?.end_date)} •
                                        {itinerary?.request?.travelers} traveler{itinerary?.request?.travelers > 1 ? 's' : ''} •
                                        ${itinerary?.request?.budget} budget
                                    </p>
                                </div>
                                <button
                                    onClick={() => simulateDisruption()}
                                    className="px-6 py-3 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-xl font-bold hover:from-red-600 hover:to-pink-700 shadow-lg transition-all transform hover:-translate-y-1"
                                >
                                    ⚡ Simulate Disruption
                                </button>
                            </div>
                        </div>

                        {/* Calendar View */}
                        <div className="mb-8 bg-gradient-to-r from-red-400 to-pink-500 rounded-2xl p-6 text-white">
                            <h3 className="text-2xl font-bold mb-4">📅 Daily Calendar</h3>
                            <div className="bg-white bg-opacity-20 rounded-xl p-4">
                                <div className="grid gap-4">
                                    {calendarDays.map((day, index) => (
                                        <div key={day.date} className="bg-white bg-opacity-30 rounded-lg p-4">
                                            <h4 className="font-bold mb-3">{day.formatted} - Day {index + 1}</h4>
                                            <div className="space-y-2 text-sm">
                                                {day.events.map((event, eventIndex) => (
                                                    <div key={eventIndex} className="flex items-center">
                                                        <span className="mr-3">{event.icon} {event.time}</span>
                                                        <div className="flex-1">
                                                            <span className="font-medium">{event.event}</span>
                                                            <div className="text-xs opacity-75">{event.location}</div>
                                                        </div>
                                                        <span className="text-xs opacity-60 ml-2">{event.duration}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-4 flex space-x-3">
                                    <button
                                        onClick={downloadCalendar}
                                        className="px-4 py-2 bg-white bg-opacity-20 text-white rounded-lg hover:bg-opacity-30"
                                    >
                                        📥 Download Calendar
                                    </button>
                                    <button
                                        onClick={startDisruptionMonitoring}
                                        className="px-4 py-2 bg-yellow-500 bg-opacity-80 text-white rounded-lg hover:bg-opacity-100"
                                    >
                                        🤖 Enable AI Monitoring
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Reservations Hub */}
                        <div className="mb-8 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-2xl p-6 text-white">
                            <h3 className="text-2xl font-bold mb-4">🎫 Digital Wallet & Reservations</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {/* Flight Reservations */}
                                {itinerary?.flights?.map((flight, index) => (
                                    <div key={index} className="bg-white bg-opacity-20 rounded-lg p-4">
                                        <div className="flex justify-between items-center mb-2">
                                            <h4 className="font-bold">✈️ {index === 0 ? 'Outbound Flight' : 'Return Flight'}</h4>
                                            <span className="text-xs bg-green-200 bg-opacity-50 px-2 py-1 rounded">CONFIRMED</span>
                                        </div>
                                        <div className="text-sm mb-2">
                                            <p className="font-medium">{flight.airline} {flight.flight_id}</p>
                                            <p>{flight.departure_airport} → {flight.arrival_airport}</p>
                                            <p>{formatTime(flight.departure_time)} - {formatTime(flight.arrival_time)}</p>
                                            <p className="text-xs opacity-75">
                                                Class: {flight.travel_class || 'Economy'} •
                                                Aircraft: {flight.aircraft || 'N/A'} •
                                                ${flight.price} per person
                                            </p>
                                            <p className="text-xs opacity-75">
                                                Total for {itinerary?.request?.travelers} travelers: ${(flight.price * itinerary?.request?.travelers).toFixed(2)}
                                            </p>
                                        </div>
                                        <button
                                            onClick={() => showBoardingPass(flight, itinerary?.request)}
                                            className="text-xs bg-blue-500 bg-opacity-70 px-3 py-1 rounded hover:bg-opacity-90 w-full"
                                        >
                                            📱 Mobile Boarding Pass
                                        </button>
                                    </div>
                                ))}

                                {/* Hotel Reservations */}
                                {itinerary?.hotels?.map((hotel, index) => (
                                    <div key={index} className="bg-white bg-opacity-20 rounded-lg p-4">
                                        <div className="flex justify-between items-center mb-2">
                                            <h4 className="font-bold">🏨 Hotel</h4>
                                            <span className="text-xs bg-green-200 bg-opacity-50 px-2 py-1 rounded">CONFIRMED</span>
                                        </div>
                                        <div className="text-sm mb-2">
                                            <p className="font-medium">{hotel.name}</p>
                                            <p>{hotel.location}</p>
                                            <p>Check-in: {formatDate(itinerary?.request?.start_date)}</p>
                                            <p>Check-out: {formatDate(itinerary?.request?.end_date)}</p>
                                            <p className="text-xs opacity-75">
                                                ${hotel.price_per_night}/night • Total: ${hotel.total_price}
                                            </p>
                                            <p className="text-xs opacity-75">
                                                {itinerary?.request?.travelers} guest{itinerary?.request?.travelers > 1 ? 's' : ''}
                                            </p>
                                        </div>
                                        <div className="flex space-x-2">
                                            <button className="text-xs bg-red-500 bg-opacity-70 px-3 py-1 rounded hover:bg-opacity-90 flex-1">
                                                📞 Call Hotel
                                            </button>
                                        </div>
                                    </div>
                                ))}

                                {/* Restaurant Reservations */}
                                {itinerary?.restaurants?.slice(0, 3).map((restaurant, index) => (
                                    <div key={index} className="bg-white bg-opacity-20 rounded-lg p-4">
                                        <div className="flex justify-between items-center mb-2">
                                            <h4 className="font-bold">🍽️ Restaurant</h4>
                                            <span className="text-xs bg-green-200 bg-opacity-50 px-2 py-1 rounded">CONFIRMED</span>
                                        </div>
                                        <div className="text-sm mb-2">
                                            <p className="font-medium">{restaurant.name}</p>
                                            <p className="text-xs">{restaurant.address || restaurant.location}</p>
                                            <p>Party of {itinerary?.request?.travelers}</p>
                                            <p>Day {index + 1} - 7:00 PM</p>
                                            <div className="flex items-center mt-1">
                                                <div className="flex">
                                                    {Array.from({length: Math.floor(restaurant.rating || 4)}, (_, i) => (
                                                        <span key={i} className="text-yellow-300">⭐</span>
                                                    ))}
                                                </div>
                                                <span className="text-xs ml-2">({restaurant.rating || '4.0'})</span>
                                            </div>
                                            <p className="text-xs opacity-75">
                                                Avg. ${restaurant.price_level || '25'} per person
                                            </p>
                                        </div>
                                        <div className="flex space-x-2">
                                            <button className="text-xs bg-orange-500 bg-opacity-70 px-3 py-1 rounded hover:bg-opacity-90 flex-1">
                                                🗺️ Directions
                                            </button>
                                            {restaurant.phone && (
                                                <button className="text-xs bg-red-500 bg-opacity-70 px-3 py-1 rounded hover:bg-opacity-90">
                                                    📞
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                ))}

                                {/* Activity Reservations */}
                                {itinerary?.activities?.slice(0, 2).map((activity, index) => (
                                    <div key={index} className="bg-white bg-opacity-20 rounded-lg p-4">
                                        <div className="flex justify-between items-center mb-2">
                                            <h4 className="font-bold">{activity.category === 'sightseeing' ? '👁️' : '🎪'} Activity</h4>
                                            <span className="text-xs bg-green-200 bg-opacity-50 px-2 py-1 rounded">CONFIRMED</span>
                                        </div>
                                        <div className="text-sm mb-2">
                                            <p className="font-medium">{activity.name}</p>
                                            <p className="text-xs">{activity.location}</p>
                                            <p>Day {index + 1} - 10:00 AM</p>
                                            <p className="text-xs opacity-75">
                                                Duration: {activity.duration || '2 hours'}
                                            </p>
                                            <p className="text-xs opacity-75">
                                                ${activity.price || activity.cost} per person •
                                                Total: ${((activity.price || activity.cost) * itinerary?.request?.travelers).toFixed(2)}
                                            </p>
                                        </div>
                                        <button
                                            onClick={() => showEventTicket(activity, `Day ${index + 1}`)}
                                            className="text-xs bg-purple-500 bg-opacity-70 px-3 py-1 rounded hover:bg-opacity-90 w-full"
                                        >
                                            🎫 Show Tickets
                                        </button>
                                    </div>
                                ))}
                            </div>

                            {/* Emergency Contacts */}
                            <div className="mt-6 bg-white bg-opacity-10 rounded-lg p-4">
                                <h4 className="font-semibold mb-3 flex items-center">
                                    <i className="fas fa-exclamation-triangle mr-2"></i>🚨 Emergency Contacts
                                </h4>
                                <div className="grid md:grid-cols-2 gap-2 text-sm">
                                    <div><i className="fas fa-hotel mr-2"></i>Hotel: {itinerary?.hotels?.[0]?.phone || '+1-800-HOTEL'}</div>
                                    <div><i className="fas fa-ambulance mr-2"></i>Emergency: 911</div>
                                    <div><i className="fas fa-flag-usa mr-2"></i>US Embassy: Check local embassy</div>
                                    <div><i className="fas fa-shield-alt mr-2"></i>Travel Insurance: 1-800-555-0123</div>
                                </div>
                            </div>
                        </div>



                        {/* Trip Actions */}
                        <div className="flex justify-center">
                            <button
                                onClick={() => cancelTrip(selectedTrip.trip_id)}
                                className="px-6 py-3 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 shadow-lg"
                            >
                                <i className="fas fa-trash mr-2"></i>Cancel Trip
                            </button>
                        </div>
                    </div>
                );
            };

            // Enhanced Disruption Simulation Functions
            const simulateDisruption = () => {
                // Create overlay backdrop
                const overlay = document.createElement('div');
                overlay.id = 'disruption-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.7);
                    z-index: 1000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                `;

                // Create modal content
                const modal = document.createElement('div');
                modal.style.cssText = `
                    background: white;
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                    text-align: center;
                    animation: modalSlideIn 0.5s ease-out;
                `;

                const disruptionTypes = ['flight_delay', 'weather_storm', 'restaurant_closed'];
                const disruption = disruptionTypes[Math.floor(Math.random() * disruptionTypes.length)];

                modal.innerHTML = `
                    <div>
                        <div style="font-size: 4rem; margin-bottom: 1rem;">🚨</div>
                        <h2 style="font-size: 2rem; font-weight: bold; margin-bottom: 1rem; color: #ef4444;">Disruption Detected!</h2>
                        <div id="status-text" style="font-size: 1.2rem; margin-bottom: 2rem; color: #6b7280;">
                            Analyzing ${disruption.replace('_', ' ')}...
                        </div>
                        <div id="progress-bar" style="width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                            <div id="progress-fill" style="width: 0%; height: 100%; background: linear-gradient(90deg, #ef4444, #f59e0b); transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                `;

                overlay.appendChild(modal);
                document.body.appendChild(overlay);

                // Simulate AI processing
                const steps = [
                    { text: 'Scanning for disruptions...', progress: 20 },
                    { text: 'Analyzing alternative options...', progress: 50 },
                    { text: 'Optimizing new schedule...', progress: 75 },
                    { text: 'Applying smart rescheduling...', progress: 100 }
                ];

                let stepIndex = 0;
                const processInterval = setInterval(() => {
                    if (stepIndex < steps.length) {
                        const step = steps[stepIndex];
                        document.getElementById('status-text').textContent = step.text;
                        document.getElementById('progress-fill').style.width = step.progress + '%';
                        stepIndex++;
                    } else {
                        clearInterval(processInterval);

                        setTimeout(() => {
                            const solutions = generateDisruptionSolutions(disruption);
                            showResolutionResults(modal, disruption, solutions);
                        }, 1000);
                    }
                }, 1200);
            };

            const generateDisruptionSolutions = (disruptionType) => {
                switch(disruptionType) {
                    case 'flight_delay':
                        return [
                            '✈️ Rebooked on next available flight (+2 hours)',
                            '🏨 Hotel upgraded due to delay compensation',
                            '🍽️ Dinner reservation moved to 8:30 PM',
                            '🎪 Morning activity rescheduled to afternoon'
                        ];
                    case 'weather_storm':
                        return [
                            '🌧️ Outdoor activity moved to covered venue',
                            '🚗 Transportation changed to covered routes',
                            '🍽️ Restaurant booking confirmed with indoor seating',
                            '🎭 Alternative indoor cultural experience added'
                        ];
                    case 'restaurant_closed':
                        return [
                            '🍽️ New restaurant found with similar cuisine',
                            '⭐ Higher rated venue with availability',
                            '🚗 Transportation updated for new location',
                            '💰 Price difference: +$15 (covered by insurance)'
                        ];
                    default:
                        return ['🤖 AI found optimal alternatives'];
                }
            };

            const showResolutionResults = (modal, disruption, solutions) => {
                // Actually update the trip data based on disruption type
                const updatedTrip = applyDisruptionChanges(selectedTrip, disruption);
                setSelectedTrip(updatedTrip);
                updateStoredTrip(updatedTrip);

                modal.innerHTML = `
                    <div>
                        <div style="font-size: 3rem; margin-bottom: 1rem;">✅</div>
                        <h2 style="font-size: 2rem; font-weight: bold; margin-bottom: 1rem; color: #10b981;">Problem Solved!</h2>
                        <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: #6b7280;">
                            <strong>${disruption.replace('_', ' ')}</strong> has been resolved automatically
                        </p>
                        <div style="text-align: left; margin: 1.5rem 0; padding: 1rem; background: #f3f4f6; border-radius: 12px;">
                            <h3 style="font-weight: bold; margin-bottom: 0.5rem; color: #374151;">🔄 Changes Applied:</h3>
                            ${solutions.map(solution => `<p style="margin: 0.5rem 0; font-size: 0.9rem;">${solution}</p>`).join('')}
                            <p style="margin: 1rem 0 0 0; font-size: 0.8rem; color: #6b7280; font-style: italic;">✅ Trip data has been updated and saved</p>
                        </div>
                        <button onclick="
                            const overlay = document.getElementById('disruption-overlay');
                            if (overlay) {
                                overlay.style.animation = 'modalSlideOut 0.3s ease-in';
                                setTimeout(() => overlay.remove(), 300);
                            }
                            // Force re-render of the dashboard to show updated data
                            window.location.reload();
                        " style="
                            width: 100%;
                            padding: 1rem 2rem;
                            background: linear-gradient(135deg, #10b981, #059669);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            font-size: 1.1rem;
                            font-weight: bold;
                            cursor: pointer;
                            transition: transform 0.2s ease;
                        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            Perfect! Continue Trip ✨
                        </button>
                    </div>
                `;

                // Apply visual changes to calendar items
                setTimeout(() => {
                    applyVisualRescheduling();
                }, 500);
            };

            const closeDisruptionOverlay = () => {
                const overlay = document.getElementById('disruption-overlay');
                if (overlay) {
                    overlay.style.animation = 'modalSlideOut 0.3s ease-in';
                    setTimeout(() => overlay.remove(), 300);
                }
            };

            const applyVisualRescheduling = () => {
                // Add rescheduling animations to calendar items
                const calendarItems = document.querySelectorAll('.bg-white.bg-opacity-30');
                calendarItems.forEach((item, index) => {
                    if (index === 0) { // First day gets rescheduling animation
                        item.style.animation = 'rescheduleFlash 2s ease-in-out';
                        item.style.border = '2px solid #f59e0b';
                    }
                });
            };

            // Function to actually apply disruption changes to trip data
            const applyDisruptionChanges = (trip, disruptionType) => {
                const updatedTrip = { ...trip };
                const itinerary = updatedTrip.trip_data.basic_itinerary || updatedTrip.trip_data.comprehensive_itinerary;

                switch(disruptionType) {
                    case 'flight_delay':
                        // Update flight times
                        if (itinerary?.flights?.[0]) {
                            const originalTime = itinerary.flights[0].departure_time || '08:00';
                            const delayedTime = originalTime.replace(/\d{2}:/, match => {
                                const hour = parseInt(match.slice(0, 2)) + 3; // Add 3 hour delay
                                return (hour < 10 ? '0' : '') + hour + ':';
                            });
                            itinerary.flights[0].departure_time = delayedTime;
                            itinerary.flights[0].status = 'DELAYED - Rescheduled';
                        }

                        // Update hotel check-in
                        if (itinerary?.hotels?.[0]) {
                            itinerary.hotels[0].checkin_time = '17:00'; // Later check-in
                            itinerary.hotels[0].room_upgrade = 'Complimentary upgrade due to delay';
                        }

                        // Update restaurant reservations
                        if (itinerary?.restaurants?.[0]) {
                            itinerary.restaurants[0].reservation_time = '20:30';
                            itinerary.restaurants[0].status = 'Rescheduled due to flight delay';
                        }
                        break;

                    case 'weather_storm':
                        // Update activities to indoor alternatives
                        if (itinerary?.activities) {
                            itinerary.activities.forEach((activity, index) => {
                                if (activity.category === 'sightseeing' || activity.location?.includes('Park')) {
                                    activity.name = activity.name.replace('Park', 'Museum').replace('Outdoor', 'Indoor');
                                    activity.location = activity.location?.replace('Park', 'Museum') || 'Indoor venue';
                                    activity.weather_alternative = true;
                                    activity.status = 'Moved indoors due to weather';
                                }
                            });
                        }

                        // Update restaurants to confirm indoor seating
                        if (itinerary?.restaurants) {
                            itinerary.restaurants.forEach(restaurant => {
                                restaurant.seating = 'Indoor seating confirmed';
                                restaurant.weather_notes = 'Protected from storm';
                            });
                        }
                        break;

                    case 'restaurant_closed':
                        // Replace first restaurant with alternative
                        if (itinerary?.restaurants?.[0]) {
                            const originalName = itinerary.restaurants[0].name;
                            itinerary.restaurants[0] = {
                                ...itinerary.restaurants[0],
                                name: 'Bistro Excellence (Alternative)',
                                rating: 4.8,
                                price_level: itinerary.restaurants[0].price_level + 15,
                                status: `Replacement for ${originalName} (closed)`,
                                cuisine: itinerary.restaurants[0].cuisine || 'International',
                                location: '2 blocks from original location',
                                insurance_covered: true
                            };
                        }
                        break;
                }

                // Add disruption metadata
                updatedTrip.last_disruption = {
                    type: disruptionType,
                    date: new Date().toISOString(),
                    resolved: true,
                    changes_applied: true
                };

                return updatedTrip;
            };

            // Boarding Pass Functions
            const showBoardingPass = (flight, tripData) => {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    z-index: 2000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                `;

                const flightNumber = flight.flight_id || 'SH' + Math.floor(Math.random() * 9000 + 1000);
                const gate = String.fromCharCode(65 + Math.floor(Math.random() * 10)) + Math.floor(Math.random() * 20 + 1);
                const seat = Math.floor(Math.random() * 30 + 1) + String.fromCharCode(65 + Math.floor(Math.random() * 6));

                modal.innerHTML = `
                    <div style="
                        background: white;
                        border-radius: 20px;
                        padding: 0;
                        max-width: 600px;
                        width: 90%;
                        overflow: hidden;
                        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
                    ">
                        <div style="
                            background: linear-gradient(135deg, #1e40af, #3b82f6);
                            color: white;
                            padding: 2rem;
                            text-align: center;
                        ">
                            <h2 style="margin: 0 0 0.5rem 0; font-size: 2rem;">✈️ BOARDING PASS</h2>
                            <p style="margin: 0; opacity: 0.9; font-size: 1.1rem;">Shell Hacks Airlines</p>
                        </div>

                        <div style="padding: 2rem;">
                            <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 2rem; align-items: center; margin-bottom: 2rem;">
                                <div style="text-align: center;">
                                    <h3 style="margin: 0; font-size: 1.5rem; font-weight: bold;">${flight.departure_airport || 'NYC'}</h3>
                                    <p style="margin: 0.5rem 0 0 0; color: #6b7280;">Departure</p>
                                </div>
                                <div style="text-align: center; color: #3b82f6; font-size: 2rem;">→</div>
                                <div style="text-align: center;">
                                    <h3 style="margin: 0; font-size: 1.5rem; font-weight: bold;">${flight.arrival_airport || 'LAX'}</h3>
                                    <p style="margin: 0.5rem 0 0 0; color: #6b7280;">Arrival</p>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1rem; margin: 2rem 0; text-align: center;">
                                <div>
                                    <h4 style="margin: 0; font-size: 1.2rem; font-weight: bold;">${flightNumber}</h4>
                                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.9rem;">Flight</p>
                                </div>
                                <div>
                                    <h4 style="margin: 0; font-size: 1.2rem; font-weight: bold;">${gate}</h4>
                                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.9rem;">Gate</p>
                                </div>
                                <div>
                                    <h4 style="margin: 0; font-size: 1.2rem; font-weight: bold;">${seat}</h4>
                                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.9rem;">Seat</p>
                                </div>
                                <div>
                                    <h4 style="margin: 0; font-size: 1.2rem; font-weight: bold;">14:30</h4>
                                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.9rem;">Boarding</p>
                                </div>
                            </div>

                            <div style="text-align: center; margin: 2rem 0;">
                                <div class="barcode-container" style="margin: 1rem auto; max-width: 300px; cursor: pointer;" onclick="
                                    const scanLine = this.querySelector('.scan-line');
                                    scanLine.style.animation = 'none';
                                    setTimeout(() => {
                                        scanLine.style.animation = 'barcodeScanning 1.5s ease-in-out';
                                        // Show scan success feedback
                                        setTimeout(() => {
                                            const feedback = document.createElement('div');
                                            feedback.textContent = '✅ Scan Successful';
                                            feedback.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(76, 175, 80, 0.9); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem; z-index: 10; animation: fadeInOut 2s ease-in-out;';
                                            this.style.position = 'relative';
                                            this.appendChild(feedback);
                                            setTimeout(() => feedback.remove(), 2000);
                                        }, 1500);
                                    }, 100);
                                ">
                                    <div class="barcode-lines">||||| ||||| ||||| ||||| |||||</div>
                                    <div class="scan-line"></div>
                                </div>
                                <p style="margin: 0; color: #6b7280; font-size: 0.8rem;">📱 Tap barcode to scan • Valid for mobile boarding</p>
                            </div>

                            <button onclick="this.closest('[style*=\'position: fixed\']').remove()" style="
                                width: 100%;
                                padding: 1rem;
                                background: linear-gradient(135deg, #3b82f6, #1e40af);
                                color: white;
                                border: none;
                                border-radius: 12px;
                                font-size: 1.1rem;
                                font-weight: bold;
                                cursor: pointer;
                            ">
                                Close Boarding Pass
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            };

            // Event Ticket Functions
            const showEventTicket = (activity, date) => {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    z-index: 2000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                `;

                const ticketId = '#SH' + Math.floor(Math.random() * 900000 + 100000);
                const time = Math.floor(Math.random() * 12 + 1) + ':' + (Math.floor(Math.random() * 2) ? '00' : '30') + ' ' + (Math.random() > 0.5 ? 'PM' : 'AM');

                modal.innerHTML = `
                    <div style="
                        background: white;
                        border-radius: 20px;
                        padding: 0;
                        max-width: 500px;
                        width: 90%;
                        overflow: hidden;
                        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
                    ">
                        <div style="
                            background: linear-gradient(135deg, #f59e0b, #d97706);
                            color: white;
                            padding: 2rem;
                            text-align: center;
                        ">
                            <h2 style="margin: 0 0 0.5rem 0; font-size: 2rem;">🎫 EVENT TICKET</h2>
                            <p style="margin: 0; opacity: 0.9; font-size: 1.1rem;">${activity.name}</p>
                        </div>

                        <div style="padding: 2rem;">
                            <div style="text-align: center; margin-bottom: 2rem;">
                                <p style="margin: 0 0 1rem 0; color: #6b7280;">${activity.location}</p>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin: 2rem 0; text-align: center;">
                                <div>
                                    <h4 style="margin: 0; font-size: 1.1rem; font-weight: bold;">${date}</h4>
                                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.9rem;">Date</p>
                                </div>
                                <div>
                                    <h4 style="margin: 0; font-size: 1.1rem; font-weight: bold;">${time}</h4>
                                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.9rem;">Time</p>
                                </div>
                                <div>
                                    <h4 style="margin: 0; font-size: 1.1rem; font-weight: bold;">${ticketId}</h4>
                                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.9rem;">Ticket ID</p>
                                </div>
                            </div>

                            <div style="text-align: center; margin: 2rem 0; padding: 1rem; background: #f3f4f6; border-radius: 12px;">
                                <p style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.9rem;">Present this ticket at the venue</p>
                                <div class="barcode-container" style="margin: 1rem auto; max-width: 280px; cursor: pointer;" onclick="
                                    const scanLine = this.querySelector('.scan-line');
                                    scanLine.style.animation = 'none';
                                    setTimeout(() => {
                                        scanLine.style.animation = 'barcodeScanning 1.5s ease-in-out';
                                        setTimeout(() => {
                                            const feedback = document.createElement('div');
                                            feedback.textContent = '✅ Ticket Verified';
                                            feedback.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(76, 175, 80, 0.9); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem; z-index: 10; animation: fadeInOut 2s ease-in-out;';
                                            this.style.position = 'relative';
                                            this.appendChild(feedback);
                                            setTimeout(() => feedback.remove(), 2000);
                                        }, 1500);
                                    }, 100);
                                ">
                                    <div class="barcode-lines">||||| ||||| ||||| ||||| ||||| ||||| |||||</div>
                                    <div class="scan-line"></div>
                                </div>
                                <p style="margin: 0; color: #6b7280; font-size: 0.8rem;">📱 Tap to verify • ID: ${Math.random().toString(36).substring(2, 15).toUpperCase()}</p>
                            </div>

                            <button onclick="this.closest('[style*=\'position: fixed\']').remove()" style="
                                width: 100%;
                                padding: 1rem;
                                background: linear-gradient(135deg, #10b981, #059669);
                                color: white;
                                border: none;
                                border-radius: 12px;
                                font-size: 1.1rem;
                                font-weight: bold;
                                cursor: pointer;
                            ">
                                Close Ticket
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            };

            // Top Navigation Component
            const TopNavigation = () => (
                <div className="fixed top-0 left-0 right-0 z-50 bg-white shadow-lg border-b border-gray-200">
                    <div className="container mx-auto px-6 py-4">
                        <div className="flex justify-between items-center">
                            {/* Logo/Brand */}
                            <div
                                onClick={() => isAuthenticated ? setCurrentStep('trips') : null}
                                className={`flex items-center ${isAuthenticated ? 'cursor-pointer hover:opacity-80' : ''} transition-opacity`}
                            >
                                <div className="text-3xl mr-3">🌍</div>
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-800">TravelMaster</h1>
                                    <p className="text-sm text-gray-600">AI-Powered Trip Planning</p>
                                </div>
                            </div>

                            {/* Navigation Buttons - Only show when authenticated */}
                            {isAuthenticated && (
                                <div className="flex items-center space-x-4">
                                    <button
                                        onClick={() => setCurrentStep('trips')}
                                        className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                                            currentStep === 'trips' || currentStep === 'dashboard'
                                                ? 'bg-blue-500 text-white shadow-lg'
                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                        }`}
                                    >
                                        <i className="fas fa-tachometer-alt mr-2"></i>My Trips
                                    </button>
                                    <button
                                        onClick={() => setCurrentStep('planning')}
                                        className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                                            currentStep === 'planning' || currentStep === 'results' || currentStep === 'booked'
                                                ? 'bg-green-500 text-white shadow-lg'
                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                        }`}
                                    >
                                        <i className="fas fa-plus mr-2"></i>Plan New Trip
                                    </button>

                                    {/* User Profile & Logout */}
                                    <div className="flex items-center space-x-3 ml-4 pl-4 border-l border-gray-300">
                                        <div className="flex items-center space-x-2">
                                            <img
                                                src={user?.picture || 'https://via.placeholder.com/40'}
                                                alt="Profile"
                                                className="w-8 h-8 rounded-full"
                                            />
                                            <span className="text-sm font-medium text-gray-700">
                                                {user?.name || user?.email || 'Demo User'}
                                            </span>
                                        </div>
                                        <button
                                            onClick={logout}
                                            className="px-4 py-2 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition-colors"
                                        >
                                            <i className="fas fa-sign-out-alt mr-1"></i>Logout
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );

            // Main render logic
            const renderCurrentView = () => {
                // Show auth screen if not authenticated
                if (!isAuthenticated && !authLoading) {
                    return <AuthComponent />;
                }

                // Show auth component initially if in auth step
                if (currentStep === 'auth') {
                    return <AuthComponent />;
                }

                // Show loading screen while auth is loading
                if (authLoading) {
                    return (
                        <div className="glass-effect rounded-2xl p-8 shadow-2xl max-w-md w-full mx-auto text-center">
                            <i className="fas fa-plane fa-spin text-4xl text-blue-500 mb-4"></i>
                            <h2 className="text-xl font-semibold text-gray-800 mb-2">Preparing Your Journey</h2>
                            <p className="text-gray-600">Setting up your personalized travel experience...</p>
                        </div>
                    );
                }

                switch(currentStep) {
                    case 'planning': return <PlanningForm />;
                    case 'results': return <ResultsDisplay />;
                    case 'booked': return <BookingConfirmation />;
                    case 'trips': return <TripsListView />;
                    case 'dashboard': return <TripDashboard />;
                    default: return <TripsListView />;
                }
            };

            return (
                <div className="min-h-screen">
                    <TopNavigation />
                    <div className="pt-24 travel-bg flex items-center justify-center p-4">
                        <div className="w-full flex justify-center">
                            {renderCurrentView()}
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app (React 18 compatible)
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TravelMasterApp />);
    </script>
</body>

</html>
